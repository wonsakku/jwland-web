<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jwland.web.mapper.ClassMapper">

	<insert id="enrollClass" parameterType="com.jwland.domain.classes.ClassDomain">
		INSERT INTO jwland.class(class_name, open_year, open_month, start_date, total_class_count, created_at, create_account_id, modify_at, modify_account_id)
		VALUES(#{className}, #{openYear}, #{openMonth}, #{startDate}, #{totalClassCount}, now(), #{createAccountId}, now(), #{modifyAccountId})
	</insert>

	<select id="findClassByClassName" parameterType="String" resultType="com.jwland.domain.classes.ClassDomain">
		SELECT * FROM jwland.class
		WHERE class_name = #{className}
	</select>
	
	<select id="getClassDetails" parameterType="String" resultType="com.jwland.domain.classes.ClassDetailDto">
		SELECT class_sequence_no, class_name, open_year, open_month, start_date, open
		FROM jwland.class
		WHERE open = #{open}
		ORDER BY open DESC
	</select>


	<select id="getEnrolledAccounts" parameterType="int" resultType="int">
		SELECT account_sequence_no
		FROM jwland.account_class_map
		WHERE class_sequence_no = #{classSequenceNo}
	</select>


	<delete id="deleteMapTableWithClassSequenceNo" parameterType="int">
		DELETE FROM jwland.account_class_map
		WHERE class_sequence_no = #{classSequenceNo}
	</delete>
	
	<insert id="enrollStudentToClass" parameterType="map">
		INSERT INTO jwland.account_class_map(class_sequence_no, account_sequence_no)
		VALUES(#{classSequenceNo}, #{accountSequenceNo})
	</insert>
	
		
	<select id="getEnrolledAccountInfos" parameterType="int" resultType="com.jwland.domain.classes.EnrolledAccountsDto">
		SELECT acm.account_sequence_no, a.name, a.nick_name
		FROM jwland.account_class_map acm
		LEFT JOIN jwland.account a
		ON acm.account_sequence_no = a.account_sequence_no
		WHERE acm.class_sequence_no = #{classSequenceNo}
	</select>
	
	
	<select id="getClassDate" parameterType="int" resultType="String">
		SELECT class_date
		FROM jwland.class_attendance_management
		WHERE class_sequence_no = #{classSequenceNo}
		GROUP BY class_date
	</select>

	<delete id="deleteClassAttendanceInfo" parameterType="map">
		DELETE FROM jwland.class_attendance_management
		WHERE class_sequence_no = #{classSequenceNo}::INT
		AND class_date = #{classDate}
	</delete>	
	
	<insert id="enrollAttendanceInfo" parameterType="ClassAttendanceManagementVO">
		INSERT INTO jwland.class_attendance_management(class_sequence_no, account_sequence_no, class_date, status, create_account_id, modify_account_id)
		VALUES(#{classSequenceNo}, #{accountSequenceNo}, #{classDate}, #{status}, #{createAccountId}, #{modifyAccountId} )
	</insert>
	
	<select id="findAttendanceInfoByDate" parameterType="map" resultType="PersonalClassAttendanceDto">
		SELECT account_sequence_no, status FROM jwland.class_attendance_management
		WHERE class_sequence_no = #{classSequenceNo}::INT
		AND class_date = #{classDate}
	</select>
	

</mapper>










