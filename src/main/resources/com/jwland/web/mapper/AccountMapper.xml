<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jwland.web.mapper.AccountMapper">

	<select id="login" resultType="com.jwland.domain.account.AccountVO">
		SELECT account_sequence_no, password, role, approved, id
		FROM jwland.account
		WHERE id = #{id}
	</select>

	<insert id="join" parameterType="com.jwland.domain.account.dto.JoinAccountDto">
		INSERT INTO jwland.account(name, id, password, grade_sequence_no, school_sequence_no)
		VALUES(#{name}, #{id}, #{password}, #{gradeSequenceNo}, #{schoolSequenceNo})
	</insert>

	<select id="findByName" resultType="com.jwland.domain.account.AccountVO">
<!-- 		SELECT account_sequence_no, birth, role, approved, nick_name -->
		SELECT *
		FROM jwland.account
		WHERE name = #{id}
	</select>

	<select id="findAccountsInfo" resultType="com.jwland.domain.account.dto.AccountInfoDto">
		SELECT a.account_sequence_no
			 , a.name
			 , g.grade
			 , s.school_name
		FROM jwland.account a
		LEFT JOIN jwland.grades g
		ON a.grade_sequence_no = g.grade_sequence_no
		LEFT JOIN jwland.school s
		ON s.school_sequence_no = a.school_sequence_no
		WHERE 1=1
		AND	  role != 'ROLE_ADMIN'
		<if test="name != null and name != ''">
			AND name LIKE '%' || #{name} || '%'
		</if>
		<if test="gradeSequenceNo != null and gradeSequenceNo != ''">
			AND a.grade_sequence_no = #{gradeSequenceNo}::INT
		</if>
		AND approved = 'Y'
		ORDER BY account_sequence_no
	</select>


	<select id="idDuplicationCheck" parameterType="com.jwland.domain.account.dto.JoinAccountDto" resultType="map">
		SELECT * FROM jwland.account
		WHERE id = #{id}
	</select>


</mapper>








